









Welcome to Cloud Shell! Type "help" to get started.
Your Cloud Platform project in this session is set to white-stacker-461009-g9.
Use `gcloud config set project [PROJECT_ID]` to change to a different project.
gcloud compute ssh --zone "us-west1-b" "kernel-dev-free" --project "white-stacker-461009-g9"joshua_thweny23@cloudshell:~ (white-stacker-461009-g9)$ gcloud compute ssh --zone "us-west1-b" "kernel-dev-free" --project "white-stacker-461009-g9"joshuathweny@Mac Desktop % hostname
ls -la ~/
ls -la ~/exynos9825_kernel_kernelsu/
ls -la ~/exynos9825_kernel_kernelsu/drivers/ (to check for the kernelsu symlink)
ls -la ~/proton-clang/
~/proton-clang/bin/clang --version
Mac
total 31728
drwxr-x---+ 156 joshuathweny  staff     4992 May 26 13:26 .
drwxr-xr-x    5 root          admin      160 May  1 20:07 ..
drwxr-x---@  18 joshuathweny  staff      576 May 24 21:45 .android
-rw-------@   1 joshuathweny  staff    62137 May 26 13:27 .bash_history
-rw-r--r--@   1 joshuathweny  staff      894 May 24 22:13 .bash_profile
joshuathweny@Mac Desktop % ory: /Users/joshuathweny/proton-clang/bin/clangtoryation.mdhua.thweny18@gmail.comtorage/GoogleDrive-jos
ERROR: (gcloud) The project property must be set to a valid project ID, [white-stacker-461009-g9joshuathweny@Mac] is not a valid project ID.
To set your project, run:

  $ gcloud config set project PROJECT_ID

or to unset it, run:

  $ gcloud config unset project
total 36
drwxr-x--- 5 joshua_thweny23 joshua_thweny23 4096 May 26 12:57 .
drwxr-xr-x 4 root            root            4096 May 26 12:57 ..
-rw-r--r-- 1 joshua_thweny23 joshua_thweny23  220 Mar 31  2024 .bash_logout
-rw-r--r-- 1 joshua_thweny23 joshua_thweny23 3809 May 18 07:11 .bashrc
drwxr-xr-x 3 joshua_thweny23 joshua_thweny23 4096 May 18 07:51 .config
drwxrwxr-x 2 joshua_thweny23 joshua_thweny23 4096 May 26 12:57 .docker
drwxrwxr-x 3 joshua_thweny23 joshua_thweny23 4096 May 26 12:57 .npm
-rw-r--r-- 1 joshua_thweny23 joshua_thweny23  807 Mar 31  2024 .profile
-rwxr-xr-x 1 joshua_thweny23 joshua_thweny23  913 May 26 12:57 README-cloudshell.txt
-rw-r--r-- 1 joshua_thweny23 joshua_thweny23    0 May 26 12:57 .sudo_as_admin_successful
ls: cannot access '/home/joshua_thweny23/exynos9825_kernel_kernelsu/': No such file or directory
-bash: syntax error near unexpected token `('
ls: cannot access '/home/joshua_thweny23/proton-clang/': No such file or directory
-bash: /home/joshua_thweny23/proton-clang/bin/clang: No such file or directory
-bash: Mac: command not found
-bash: total: command not found
-bash: drwxr-x---+: command not found
-bash: drwxr-xr-x: command not found
-bash: drwxr-x---@: command not found
-bash: -rw-------@: command not found
-bash: -rw-r--r--@: command not found
-bash: -rw-r--r--@: command not found
-bash: drwx------: command not found
-bash: -rw-r--r--@: command not found
-bash: drwx------@: command not found
-bash: -rw-------@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: -rw-------: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwx------@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: -rw-r--r--@: command not found
-bash: -rw-------@: command not found
-bash: -rw-r--r--@: command not found
-bash: drwxr-xr-x: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: -rw-r--r--@: command not found
-bash: drwx------: command not found
-bash: drwx------: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x: command not found
-bash: drwxr-xr-x: command not found
-bash: drwxr-xr-x: command not found
-bash: drwx------@: command not found
-bash: drwxr-xr-x: command not found
-bash: -rw-------@: command not found
-bash: drwxr-x---: command not found
-bash: -rw-r--r--@: command not found
-bash: drwxr-xr-x: command not found
-bash: drwxr-xr-x@: command not found
-bash: -rw-r--r--@: command not found
-bash: -rw-r--r--@: command not found
-bash: -rw-r--r--@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: -rw-r--r--@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: -rw-r--r--@: command not found
-bash: drwxr-xr-x@: command not found
-bash: -rw-------@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: -rw-r--r--@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwx------@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwx------@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwx------@: command not found
-bash: drwx------+: command not found
-bash: -rw-------@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwx------@: command not found
-bash: -rw-r--r--@: command not found
-bash: -rw-r--r--@: command not found
-bash: -rw-r--r--@: command not found
-bash: -rw-r--r--@: command not found
-bash: -rw-r--r--@: command not found
-bash: -rw-------@: command not found
-bash: drwx------: command not found
-bash: -rw-r--r--@: command not found
-bash: -rw-r--r--@: command not found
-bash: -rw-r--r--@: command not found
-bash: -rw-------: command not found
-bash: -rw-r--r--@: command not found
-bash: -rw-r--r--@: command not found
-bash: drwxr-xr-x: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwx------@: command not found
-bash: syntax error near unexpected token `('
-bash: drwxr-xr-x@: command not found
-bash: -rw-r--r--@: command not found
-bash: drwxr-xr-x@: command not found
-bash: -rw-r--r--@: command not found
-bash: -rw-r--r--@: command not found
-bash: drwx------@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwx------@: command not found
-bash: drwx------@: command not found
-bash: -rw-r--r--: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: /Users/joshuathweny/Library/CloudStorage/GoogleDrive-joshua.thweny@gmail.com: No such file or directory
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x: command not found
-bash: drwxr-xr-x: command not found
-bash: -rw-r--r--@: command not found
-bash: -rw-r--r--@: command not found
-bash: -rw-r--r--@: command not found
-bash: -rw-r--r--@: command not found
-bash: drwxr-xr-x: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwx------@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwx------@: command not found
-bash: drwx------@: command not found
-bash: drwx------@: command not found
-bash: -rw-r--r--@: command not found
-bash: drwxr-xr-x: command not found
-bash: -rw-r--r--@: command not found
-bash: -rw-------: command not found
-bash: drwxr-xr-x@: command not found
-bash: -rw-r--r--: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwx------@: command not found
-bash: drwxr-xr-x: command not found
-bash: drwxr-xr-x+: command not found
-bash: -rw-r--r--@: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x@: command not found
-bash: -rw-------@: command not found
-bash: drwxr-xr-x@: command not found
-bash: -rw-r--r--: command not found
-bash: -rw-r--r--: command not found
-bash: -rw-r--r--: command not found
-bash: -rw-r--r--: command not found
-bash: -rw-r--r--: command not found
-bash: -rw-r--r--: command not found
-bash: -rw-r--r--: command not found
-bash: -rw-r--r--: command not found
-bash: -rw-r--r--: command not found
-bash: -rw-r--r--: command not found
-bash: drwxr-xr-x: command not found
-bash: drwxr-xr-x: command not found
-bash: drwxr-xr-x@: command not found
-bash: drwxr-xr-x: command not found
-bash: drwxr-xr-x: command not found
-bash: -rw-r--r--@: command not found
-bash: drwxr-xr-x@: command not found
-bash: ls:: command not found
-bash: zsh:: command not found
-bash: ls:: command not found
-bash: zsh:: command not found
-bash: joshuathweny@Mac: command not found
joshua_thweny23@cloudshell:~ (white-stacker-461009-g9)$ #!/bin/bash
# Custom startup script for kernel-dev-free VM (Exynos KernelSU & Proton Clang)

export DEBIAN_FRONTEND=noninteractive

echo "Updating system packages..."
apt-get update
apt-get upgrade -y

echo "Installing essential development tools and dependencies..."
# Added common tools and cross-compilers
apt-get install -y \
    build-essential git ccache flex bison libssl-dev libelf-dev \
    libncurses-dev autoconf libudev-dev libtool automake pkg-config \
    python3 python3-pip python-is-python3 bc rsync curl wget \
    zip unzip libxml2-utils \
    gcc-aarch64-linux-gnu gcc-arm-linux-gnueabi \
    binutils-aarch64-linux-gnu binutils-arm-linux-gnueabi

echo "Setting up larger swap space (16GB) for kernel compilation..."
fallocate -l 16G /swapfile
chmod 600 /swapfile
mkswap /swapfile
swapon /swapfile
echo '/swapfile none swap sw 0 0' | tee -a /etc/fstab

# Attempt to find the primary user. Default to 'builder'.
# This user will own the cloned repositories.
PRIMARY_USER="builder" # Default user
if [ -n "$SUDO_USER" ] && [ "$SUDO_USER" != "root" ]; then
    PRIMARY_USER=$SUDO_USER
else
    # Heuristic: find first non-root user in /home
    # On GCP, the user is often the one you log in with via gcloud ssh
    FOUND_USER=$(ls /home | head -n 1)
    if [ -n "$FOUND_USER" ]; then
        PRIMARY_USER=$FOUND_USER
    fi
fi
USER_HOME="/home/$PRIMARY_USER"

echo "Operations will be performed for user: $PRIMARY_USER in $USER_HOME"

# Create user if it doesn't exist (e.g., if we defaulted to 'builder' and it's new)
if ! id "$PRIMARY_USER" &>/dev/null; then
    echo "User $PRIMARY_USER does not exist. Creating user..."
    useradd -m -s /bin/bash -G sudo $PRIMARY_USER
    echo "Created user $PRIMARY_USER. Sudo access granted."
fi
# Ensure home directory exists and has correct ownership
mkdir -p "$USER_HOME"
chown -R $PRIMARY_USER:$PRIMARY_USER "$USER_HOME"

echo "Configuring git for user $PRIMARY_USER..."
sudo -u $PRIMARY_USER bash -c "git config --global core.editor vim; git config --global user.name 'Kernel Builder'; git config --global user.email '$PRIMARY_USER@example.com'"
echo "Please update your git user.name and user.email for $PRIMARY_USER on the VM later."

echo "Cloning Proton Clang to $USER_HOME/proton-clang for user $PRIMARY_USER..."
sudo -u $PRIMARY_USER git clone --depth=1 https://github.com/kdrag0n/proton-clang.git "$USER_HOME/proton-clang"

echo "Cloning Exynos KernelSU source to $USER_HOME/exynos9825_kernel_kernelsu for user $PRIMARY_USER..."
sudo -u $PRIMARY_USER git clone --depth=1 https://github.com/Bartek0x00/Exynos982X-KernelSU.git "$USER_HOME/exynos9825_kernel_kernelsu"

if [ -d "$USER_HOME/exynos9825_kernel_kernelsu" ]; then
    echo "Initializing KernelSU submodule in $USER_HOME/exynos9825_kernel_kernelsu for user $PRIMARY_USER..."
    sudo -u $PRIMARY_USER bash -c "cd '$USER_HOME/exynos9825_kernel_kernelsu' && git submodule init && git submodule update --depth=1 KernelSU && ln -sf ../KernelSU/kernel drivers/kernelsu"
else
    echo "Kernel source directory $USER_HOME/exynos9825_kernel_kernelsu not found. Skipping submodule init."
fi

echo "Custom VM setup completed for user $PRIMARY_USER."
echo "The VM will be slow for compilation due to e2-micro type."
echo "Connect via: gcloud compute ssh kernel-dev-free --zone=us-central1-c --project=white-stacker-461009-g9"
echo "The actual username for SSH will be determined by your gcloud login/OS Login profile."